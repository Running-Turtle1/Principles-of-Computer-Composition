## 控制器

控制器由 **PC、IR、MAR、MDR、指令译码器、时序电路和微操作信号发生器**组成。 

## PSW

PSW，程序状态字寄存器，属于**运算器**的组成部分，它包括两个部分 ：

- **状态标志**，如进位标志 C、结果为零标志 Z 等。

- **控制标志**，如中断标志、陷阱标志等。

通常，执行**条件转移指令**的依据条件就来自 PSW。

## 寄存器位数

**程序计数器**字长取决于**存储器的容量** ，因为 PC 的内容为指令在主存中的地址。

**指令寄存器**位数取决于**指令字长**，因为IR用来保存正在执行的指令。

**通用寄存器**的位数取决于**机器字长**，因为 GPR 存放各种操作数和地址信息，这样便于控制。

> 有关指令字长的一点认识 ：
> 
> 一个机器周期可以完成一项任务，如果指令字长等于存储字长，那么取值周期就等于机器周期，因为访存一次就够了。
> 
> 不难想到，如果指令字长是存储字长的两倍，那就需要两次访存，花费 2 个机器周期。

## 硬布线控制器与微程序控制器

### 硬布线控制器

### 微程序控制器

1，在微程序控制器中，控制部件向执行部件发出的某个控制信号称为**微命令** 。

2，**微程序**的作用是实现一条对应的机器指令，有序的**微指令序列**构成一段微程序，而微指令又是若干**微命令**的集合。

3，通常情况下，**一个微程序的周期对应一个指令周期**。

4，在微程序控制器中，形成微程序入口地址的是**机器指令的操作码字段** 。

### 区别

微程序控制器的时序系统相比于硬布线控制器，比较简单。

## 指令和数据都放在存储器，CPU 如何区分 ？

CPU 通过**指令周期的不同执行阶段**来区分指令和数据

## 控制部件与运算部件

**控制部件** ：控制器

**执行部件** ：存储器、运算器和外围设备

## 指令地址问题

在CPU执行过程中，指令的地址是由 PC 给出的。

注意指令的地址码给出的是指令的操作码的地址。

## 微指令格式设计题目

### 题目一

> 某微程序控制器中,采用水平型直接控制(编码)方式的微指令格式,后续微指令地址由微指令的下地址字段给出。已知机器共有28个微命令,6个互斥的可测定的外部条件。控制存储器的容量为512×40位。试设计其微指令的格式,并说明理由。

水平型微指令的格式如下 ：

| 操作控制 | 顺序控制（判别测试字段 + 后续地址字段） |
| ---- | --------------------- |

微指令采用直接控制编码，操作控制一共 28 位，6 个外部条件，需要 3 个判别测试字段，后续地址 9 位即可。

| 操作控制字段 | 判别测试字段 | 后续地址字段 |
|:------:|:------:|:------:|
| 28     | 3      | 9      |

### 题目二

> 某机共有52个微操作控制信号,构成5个相斥类的微命令组,各组分别包含5、8、2、
> 15、22个微命令。已知可判定的外部条件有两个,微指令字长28位。
> 
> 1) 按水平型微指令格式设计微指令,要求微指令的下地址字段直接给出后继微指令
>    地址。
> 2) 指出控制存储器的容量。

1）加上空操作，5个微命令组共有 6，9，3, 16, 23 个微命令。

分别需要 3，4, 2, 4, 5 b。

可判定的外部条件 2 个，加上无条件转移，2b 作为判定字段。’

共 28 位，下地址字段还剩 8 位。

设计如下 ：

| 3位    | 4位    | 2位    | 4位     | 5位     | 2位     | 8位     |
|:-----:|:-----:|:-----:|:------:|:------:|:------:|:------:|
| 5个微命令 | 8个微命令 | 2个微命令 | 15个微命令 | 22个微命令 | 判别测试字段 | 后续地址字段 |

2）后续地址字段有 8 位，微指令字长 28 位，容量为 $2^8\times 28 $ 位。
